@{
     var permission = ViewData["Permission"] as Permission;
}

<table class="table px-3" style="border-radius: 6px; box-shadow: 1px 1px 15px rgb(108, 103, 103);">
    <thead>
        <tr>
            <th>
                <div class="d-flex sortDiv">
                    Name
                    <a href="#" class="sort-icon" id="sortNameAsc" data-column="Name">
                        <i class="bi bi-arrow-up"></i>
                    </a>
                    <a href="#" class="sort-icon" id="sortNameDesc" data-column="Name">
                        <i class="bi bi-arrow-down"></i>
                    </a>
                </div>
            </th>
            <th>Email</th>
            <th>Phone</th>
            <th>
                <div class="d-flex sortDiv">
                    Role
                    <a href="#" class="sort-icon" id="sortRoleAsc" data-column="Role">
                        <i class="bi bi-arrow-up"></i>
                    </a>
                    <a href="#" class="sort-icon" id="sortRoleDesc" data-column="Role">
                        <i class="bi bi-arrow-down"></i>
                    </a>
                </div>
            </th>
            <th>Status</th>
            @if(permission.Canaddedit == true || permission.Candelete == true){
            <th>Action</th>
            }
        </tr>
    </thead>
    <tbody>
        @if(@Model.Count > 0)
        {
        @foreach (var user in Model)
        {
            <tr>
                <td>
                    <div class="d-flex">
                        <img src="@(string.IsNullOrEmpty(user.Profileimg) ? Url.Content("~/images/Default_pfp.svg.png") : Url.Content("~/images/uploads/" + user.Profileimg))"
                            alt="profile image" class="me-2 bg-light"
                            style="width: 2.5rem; height: 2.5rem; border-radius: 100%;">

                        <span>@user.FirstName @user.LastName</span>
                    </div>
                </td>
                <td class="text-break d-none d-lg-table-cell">
                    @user.Email
                </td>
                <td class="d-lg-none">
                    @user.Email
                </td>
                <td>@user.Phone</td>
                <td>@user.Rolename</td>
                <td>
                    <span
                        class="@(user.status == pizzashop.repository.ViewModels.statustype.Active ? "status-badge-green" : "status-badge-red")">
                        @user.status
                    </span>
                </td>
                @if(permission.Canaddedit == true || permission.Candelete == true){
                <td>@if(user.IsSameUser == false){
                    @if(permission.Canaddedit == true){
                    <a class="btn" asp-controller="User" asp-action="EditUser" asp-route-id="@user.Id" >
                        <img src="~/images/pen.svg" alt="edit" style="max-height: 30px; height: 100%; width:auto;">
                    </a>
                    }
                    @if(permission.Candelete == true){
                    <a class="delete-user" data-bs-toggle="modal" data-id="@user.Id" data-bs-target="#delete" >
                        <img src="~/images/trash.svg" alt="delete" style="max-height: 30px; height: 100%; width:auto;">
                    </a>
                    }
                    }
                    <div class="fade modal" id="delete" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
                        aria-labelledby="staticBackdropLabel" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered" style="width: 400px;">
                            <div class="modal-content">
                                <div class="row mx-1 mt-2">
                                    <h5 class="modal-title col" id="staticBackdropLabel">Delete confirmation</h5>
                                    <button type="button" class="btn-close col-auto me-1" data-bs-dismiss="modal"
                                        aria-label="Close"></button>
                                </div>
                                <div class="d-flex justify-content-center align-items-center mt-4 flex-column">
                                    <img src="~/images/caution.png" style="height: 40px; width: 40px;">
                                    <span>Are you sure you want to delete this user?</span>
                                    <form asp-controller="User" asp-action="DeleteUser">
                                        <input type="hidden" value="" id="hiddenUserId" name="id">
                                        <div class="d-flex justify-content-center align-items-center mt-2 mb-4">
                                            <button type="submit" class="btn btn-primary" data-bs-dismiss="modal"
                                                style="border-radius: 3px; width: 60px;">Yes</button>
                                            <button type="button" class="btn ms-2 border"
                                                style="border-radius: 3px; width: 60px;">No</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </td>
                }
            </tr>
        }
        }
        else{
            <tr><td class="text-center" colspan="6">No Data Found</td></tr>
        }
    </tbody>
</table>

<div class="d-flex justify-content-end align-items-center flex-wrap gap-2 mt-2 p-3">
    <div class="d-flex align-items-center">
        <span class=" px-1">Items Per page:</span>
        <select id="pageSizeSelect" class="form-select form-select-sm" style="width: auto;">
            <option value="5" selected="@(ViewBag.PageSize == 5)">5</option>
            <option value="10" selected="@(ViewBag.PageSize == 10)">10</option>
            <option value="25" selected="@(ViewBag.PageSize == 25)">25</option>
        </select>
    </div>
    <div class="d-flex align-items-center gap-2">
        <span class=" px-1">
            Showing @(ViewBag.TotalUsers > 0 ? ((ViewBag.CurrentPage - 1) * ViewBag.PageSize + 1) : 0)
            - @(ViewBag.TotalUsers > 0 ? Math.Min(ViewBag.CurrentPage * ViewBag.PageSize, ViewBag.TotalUsers) :
              0)
            of @ViewBag.TotalUsers
        </span>
        <nav>
            <ul class="pagination pagination-sm">
                <!-- Previous Page -->
                <li class="page-item @(ViewBag.CurrentPage > 1 ? "" : "disabled")">
                    <a class="page-link pagination-link" href="#" data-page="@(ViewBag.CurrentPage - 1)">
                        <i class="bi bi-chevron-left"></i>
                    </a>
                </li>

                <!-- Next Page -->
                <li class="page-item @(ViewBag.CurrentPage < ViewBag.TotalPages ? "" : "disabled")">
                    <a class="page-link pagination-link" href="#" data-page="@(ViewBag.CurrentPage + 1)">
                        <i class="bi bi-chevron-right"></i>
                    </a>
                </li>
            </ul>
        </nav>
    </div>
</div>
<script>
    $(document).ready(function () {
        $('.delete-user').click(function () {
            var Id = $(this).data("id");
            $("#hiddenUserId").val(Id);
        })
    })
</script>